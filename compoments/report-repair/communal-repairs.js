import PropTypes from 'prop-types';
import React from 'react';
import Button from '../button';
import ComponentHeader from '../componentHeader';
import useSWR from 'swr';
import {fetcher} from '../../helpers/fetcher';
import Loader from '../loader';


const CommunalRepairs = ({ handleChange, values}) => {
  const { data, error } = useSWR(`/api/communalPropertyRepairs?propertyReference=${values.address?.locationId}`, fetcher)
  const Continue = val => {
    handleChange('reportNewCommunalRepair', true);
  }

  if (!data) return <Loader/>
  const title = 'Problems reported at this address'
  return (
    <div className="govuk-grid-row" data-cy="communal-repairs">
      <ComponentHeader data-cy='communal-repairs-heading' title={title} />
      <div className="govuk-grid-column-two-thirds">
        <h1 className='govuk-heading-xl'>{title}</h1>
        {data.length != 0 && <>
          <p className="govuk-body-m">
            These are the current open repair requests reported at this address. If the repair you want to report is listed you do not need to do anything.
          </p>
          <table className="govuk-table">
            <thead className="govuk-table__head">
              <tr className="govuk-table__row">
                <th scope="col" className="govuk-table__header app-custom-class" data-cy="communal-repairs-table-heading-1">Where is the problem?</th>
                <th scope="col" className="govuk-table__header app-custom-class" data-cy="communal-repairs-table-heading-2">What is the problem?</th>
                <th scope="col" className="govuk-table__header app-custom-class" data-cy="communal-repairs-table-heading-3">What best describes the problem</th>
                <th scope="col" className="govuk-table__header app-custom-class" data-cy="communal-repairs-table-heading-4">Specific area (user entered)</th>
              </tr>
            </thead>
            <tbody className="govuk-table__body">
              {data?.map((repair, i) => (
                <tr className="govuk-table__row">
                  <th scope="row" className="govuk-table__header" data-cy={`communal-repairs-location-${i}`}>{repair.location.display}</th>
                  <td className="govuk-table__cell" data-cy={`communal-repairs-problem-${i}`}>{repair.problem.display}</td>
                  <td className="govuk-table__cell" data-cy={`communal-repairs-issue-${i}`}>{repair.issue.display}</td>
                  <td className="govuk-table__cell" data-cy={`communal-repairs-description-${i}`}>{repair.description.text}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </>}
        {data.length == 0 && <>
          <p className="govuk-body-m">
            There are no communal repairs that have been reported for this location.
          </p>
        </>}
        <h2 className='govuk-heading-l'>The problem is not listed</h2>
        <p className="govuk-body-m">
          If the repair is not listed above you can report a new problem to the council.
        </p>
        <Button onClick={Continue} >Report a new problem</Button>
      </div>
    </div>
  );
};
CommunalRepairs.propTypes = {
  values: PropTypes.object,
};
export default CommunalRepairs;
